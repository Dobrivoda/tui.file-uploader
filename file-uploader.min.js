!function t(e,i,n){function s(o,r){if(!i[o]){if(!e[o]){var l="function"==typeof require&&require;if(!r&&l)return l(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var h=i[o]={exports:{}};e[o][0].call(h.exports,function(t){var i=e[o][1][t];return s(i?i:t)},h,h.exports,t,e,i,n)}return i[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(t,e,i){ne.util.defineNamespace("ne.component.Uploader",t("./src/js/uploader.js"))},{"./src/js/uploader.js":7}],2:[function(t,e,i){var n={type:"POST",addRequest:function(t,e){var i=this._uploader,n=i.inputView.$el,s=ne.util.bind(this.successPadding,this,t.success);e?(this.formData=new FormData,ne.util.forEach(e,function(t){this.formData.append(i.fileField,t)},this)):this.formData=new FormData(n[0]),$.ajax({url:this._uploader.url.send,type:this.type,data:this.formData,success:s,processData:!1,contentType:!1,error:t.error})},successPadding:function(t,e){var i=JSON.parse(e),n={};n.items=i.filelist,t(n)},removeRequest:function(t){var e=ne.util.bind(this.removePadding,this,t.success);$.ajax({url:this._uploader.url.remove,data:t.data,success:e,error:t.error})},removePadding:function(t,e){var i=JSON.parse(e),n={};n.action="remove",n.name=decodeURIComponent(i.name),t(n)}};e.exports=n},{}],3:[function(t,e,i){var n=t("./ajax"),s=t("./jsonp"),a=t("./local"),o={ajax:n,jsonp:s,local:a},r={removeRequest:function(t){throw new Error("The interface removeRequest does not exist")},addRequest:function(t){throw new Error("The interface addRequest does not exist")}},l={getConnector:function(t){var e=t.type.toLowerCase(),i={_uploader:t};return ne.util.extend(i,r,o[e]||a),i}};e.exports=l},{"./ajax":2,"./jsonp":4,"./local":5}],4:[function(t,e,i){var n={addRequest:function(t){var e=this._uploader.callbackName,i=t.success;ne.util.defineNamespace(e,ne.util.bind(this.successPadding,this,i)),this._uploader.inputView.$el.submit()},successPadding:function(t,e){var i={};this._uploader.isCrossDomain()?i.items=this._getSplitItems(e):i.items=ne.util.toArray(e.filelist),t(i)},_getSplitItems:function(t){var e=this._uploader.separator,i=t.status.split(e),n=t.names.split(e),s=t.sizes.split(e),a=ne.util.isString(t.ids)?t.ids.split(e):n,o=[];return ne.util.forEach(i,function(t,e){if("success"===t){var r={name:n[e],status:i[e],size:s[e],id:a[e]};o.push(r)}}),o},removeRequest:function(t){var e=this._uploader.callbackName,i={callback:e},n=t.success;ne.util.defineNamespace(e,ne.util.bind(this.removePadding,this,n),!0),$.ajax({url:this._uploader.url.remove,dataType:"jsonp",jsonp:e,data:ne.util.extend(i,t.data)})},removePadding:function(t,e){var i={};i.action="remove",i.name=decodeURIComponent(e.name),t(i)}};e.exports=n},{}],5:[function(t,e,i){var n=t("../utils"),s={_result:null,addRequest:function(t,e){var i=n.isSupportFormData(),s=this._saveFile(i,e);t.success({items:s})},_saveFile:function(t,e){var i=this._uploader,n=i.inputView,s=n.$input[0],a=[];return this._result||(this._result=[]),t?(e=e||s.files,ne.util.forEach(e,function(t){ne.util.isObject(t)&&a.push(t)},this)):a.push({name:s.value,element:s}),this._result=this._result.concat(a),a},_makeFormData:function(){var t=this._uploader,e=t.fileField,i=t.inputView,n=new window.FormData(this._extractForm(i));return ne.util.forEach(this._result,function(t){n.append(e,t)}),n},_extractForm:function(t){var e=t.$el.clone();return e[0]},removeRequest:function(t){var e=t.data;this._result=ne.util.filter(this._result,function(t){return t.name!==e.filename}),t.success({action:"remove",name:e.filename})},submit:function(t){var e=this._makeFormData(inputView);$.ajax({url:this._uploader.url.send,type:"POST",data:e,success:t,processData:!1,contentType:!1})}};e.exports=s},{"../utils":8}],6:[function(t,e,i){e.exports.CONF={RESPONSE_TYPE:"RESPONSE_TYPE",REDIRECT_URL:"REDIRECT_URL",JSONPCALLBACK_NAME:"CALLBACK_NAME",SIZE_UNIT:"SIZE_UNIT",REMOVE_CALLBACK:"responseRemoveCallback",ERROR:{DEFAULT:"Unknown error.",NOT_SURPPORT:"This is x-domain connection, you have to make helper page."},DRAG_DEFAULT_ENABLE_CLASS:"enableClass",FILE_FILED_NAME:"userfile[]",FOLDER_INFO:"folderName"},e.exports.HTML={form:['<form enctype="multipart/form-data" id="formData" method="post">','<input type="hidden" name="MAX_FILE_SIZE" value="3000000" />',"</form>"].join(""),input:['<input type="file" id="fileAttach" {{webkitdirectory}} name="{{fileField}}" {{multiple}} />'].join(""),submit:['<button class="batchSubmit" type="submit">SEND</button>'].join(""),item:['<li class="filetypeDisplayClass">','<spna class="fileicon {{filetype}}">{{filetype}}</spna>','<span class="file_name">{{filename}}</span>','<span class="file_size">{{filesize}}</span>','<button type="button" class="{{deleteButtonClassName}}">Delete</button>',"</li>"].join(""),drag:['<div class="dragzone"></div>'].join("")}},{}],7:[function(t,e,i){var n=t("./statics"),s=t("./utils"),a=t("./connector/connector"),o=t("./view/input"),r=t("./view/list"),l=t("./view/pool"),u=t("./view/drag"),h=ne.util.defineClass({init:function(t,e){this._setData(t),this._setConnector(),this.$el=e,this.useDrag&&!this.useFolder&&s.isSupportFileSystem()&&(this.dragView=new u(t,this)),this.inputView=new o(t,this),this.listView=new r(t,this),this.fileField=this.fileField||n.CONF.FILE_FILED_NAME,this._pool=new l(this.listView.$el[0]),this._addEvent()},_setConnector:function(){this.isBatchTransfer?this.type="local":this.isCrossDomain()?this.helper?this.type="jsonp":(alert(n.CONF.ERROR.NOT_SURPPORT),this.type="local"):this.useJsonp||!s.isSupportFormData()?this.type="jsonp":this.type="ajax",this._connector=a.getConnector(this)},notify:function(t){this.listView.update(t),this.listView.updateTotalInfo(t)},_setData:function(t){ne.util.extend(this,t)},isCrossDomain:function(){var t=document.domain;return-1===this.url.send.indexOf(t)},errorCallback:function(t){var e;e=t&&t.msg?t.msg:n.CONF.ERROR.DEFAULT,alert(e)},sendFile:function(t){var e=ne.util.bind(this.notify,this),i=t&&t.files;this._connector.addRequest({type:"add",success:function(i){t&&t.callback&&t.callback(i),e(i)},error:this.errorCallback},i)},removeFile:function(t){var e=ne.util.bind(this.notify,this);this._connector.removeRequest({type:"remove",data:t,success:e})},submit:function(){this._connector.submit&&(s.isSupportDataForm()?this._connector.submit(ne.util.bind(function(){this.fire("beforesubmit",this)},this)):this._pool.plant())},_getFileInfo:function(t){var e;return e=s.isSupportFileSystem()?this._getFileList(t.files):{name:t.value,id:t.value}},_getFileList:function(t){return ne.util.map(t,function(t){return{name:t.name,size:t.size,id:t.name}})},_addEvent:function(){this.useDrag&&this.dragView&&this.dragView.on("drop",this.sendFile,this),this.isBatchTransfer?(this.inputView.on("save",this.sendFile,this),this.listView.on("remove",this.removeFile,this)):(this.inputView.on("change",this.sendFile,this),this.listView.on("remove",this.removeFile,this))},store:function(t){this._pool.store(t)},remove:function(t){s.isSupportFormData()||this._pool.remove(t)}});ne.util.CustomEvents.mixin(h),e.exports=h},{"./connector/connector":3,"./statics":6,"./utils":8,"./view/drag":9,"./view/input":10,"./view/list":12,"./view/pool":13}],8:[function(t,e,i){e.exports.getFileSizeWithUnit=function(t){var e=["B","KB","MB","GB","TB"],t=parseInt(t,10),i=Math.log(t)/Math.log(1024)|0,n=(t/Math.pow(1024,i)).toFixed(2);return n+e[i]},e.exports.isSupportFormData=function(){var t=window.FormData||null;return!!t},e.exports.template=function(t,e){return e=e.replace(/\{\{([^\}]+)\}\}/g,function(e,i){return t[i]})},e.exports.isSupportFileSystem=function(){return!!(window.File&&window.FileReader&&window.FileList&&window.Blob)}},{}],9:[function(t,e,i){var n=t("../statics"),s=(t("../utils"),ne.util.defineClass({init:function(t,e){var i=t.template&&t.template.drag||n.HTML.drag;this._enableClass=t.drag&&t.drag.enableClass||n.CONF.DRAG_DEFAULT_ENABLE_CLASS,this._render(i,e),this._addEvent()},_render:function(t,e){this.$el=$(t),e.$el.append(this.$el)},_addEvent:function(){this.$el.on("dragenter",ne.util.bind(this.onDragEnter,this)),this.$el.on("dragover",ne.util.bind(this.onDragOver,this)),this.$el.on("drop",ne.util.bind(this.onDrop,this)),this.$el.on("dragleave",ne.util.bind(this.onDragLeave,this))},onDragEnter:function(t){t.preventDefault(),t.stopPropagation(),this._enable()},onDragOver:function(t){t.preventDefault(),t.stopPropagation()},onDragLeave:function(t){t.preventDefault(),t.stopPropagation(),this._disable()},onDrop:function(t){return t.preventDefault(),this._disable(),this.fire("drop",{files:t.originalEvent.dataTransfer.files}),!1},_enable:function(){this.$el.addClass(this._enableClass)},_disable:function(){this.$el.removeClass(this._enableClass)}}));ne.util.CustomEvents.mixin(s),e.exports=s},{"../statics":6,"../utils":8}],10:[function(t,e,i){var n=t("../statics"),s=t("../utils"),a=ne.util.defineClass({init:function(t,e){this._uploader=e,this._target=t.formTarget,this._url=t.url,this._isBatchTransfer=t.isBatchTransfer,this._isMultiple=!(!s.isSupportFormData()||!t.isMultiple),this._useFolder=!(!s.isSupportFormData()||!t.useFolder),this._html=this._setHTML(),this._render(),this._renderHiddenElements(),t.helper&&this._makeBridgeInfoElement(t.helper),this._addEvent()},_render:function(){this.$el=$(this._getHtml()),this.$el.attr({action:this._url.send,method:"post",enctype:"multipart/form-data",target:this._target}),this.$input=this._getInputElement(),this.$submit=this._getSubmitElement(),this.$input.appendTo(this.$el),this.$submit&&this.$submit.appendTo(this.$el),this._uploader.$el.append(this.$el)},_setHTML:function(t){return t||(t={}),{input:t.input||n.HTML.input,submit:t.submit||n.HTML.submit,form:t.form||n.HTML.form}},_getHtml:function(){return this._html.form},_getInputElement:function(){var t={multiple:this._isMultiple?"multiple":"",fileField:this._uploader.fileField,webkitdirectory:this._useFolder?"webkitdirectory":""};return $(s.template(t,this._html.input))},_getSubmitElement:function(){return this._isBatchTransfer?$(this._html.submit):!1},_renderHiddenElements:function(){this._makeTargetFrame(),this._makeResultTypeElement(),this._makeCallbackElement()},_addEvent:function(){this._isBatchTarnsfer&&this.$el.on("submit",ne.util.bind(function(){this._uploader.submit()},this)),this._addInputEvent()},_addInputEvent:function(){this._isBatchTransfer?this.$input.on("change",ne.util.bind(this.onSave,this)):this.$input.on("change",ne.util.bind(this.onChange,this))},onChange:function(){this.$input[0].value&&this.fire("change",{target:this})},onSave:function(){if(this.$el[0].value){var t=s.isSupportFormData()?null:ne.util.bind(this._resetInputElement,this);this.fire("save",{element:this.$input[0],callback:t})}},_resetInputElement:function(){this.$input.off(),this._clone(this.$input[0]),this.$input=$(this._getHtml(this._inputHTML)),this.$button?this.$button.before(this.$input):this.$el.append(this.$input),this._addInputEvent()},_makeTargetFrame:function(){this._$target=$('<iframe name="'+this._target+'"></iframe>'),this._$target.css({visibility:"hidden",position:"absolute"}),this._uploader.$el.append(this._$target)},_makeCallbackElement:function(){this._$callback=this._makeHiddenElement({name:n.CONF.JSONPCALLBACK_NAME,value:this._uploader.callbackName}),this.$el.append(this._$callback)},_makeResultTypeElement:function(){this._$resType=this._makeHiddenElement({name:this._uploader.resultTypeElementName||n.CONF.RESPONSE_TYPE,value:this._uploader.type}),this.$el.append(this._$resType)},_makeBridgeInfoElement:function(t){this._$helper=this._makeHiddenElement({name:t.name||n.CONF.REDIRECT_URL,value:t.url}),this.$el.append(this._$helper)},_makeHiddenElement:function(t){return ne.util.extend(t,{type:"hidden"}),$("<input />").attr(t)},_clone:function(t){t.file_name=t.value,this._uploader.store(t)}});ne.util.CustomEvents.mixin(a),e.exports=a},{"../statics":6,"../utils":8}],11:[function(t,e,i){var n=t("../statics"),s=t("../utils"),a=ne.util.defineClass({init:function(t){this._setRoot(t),this._setItemInfo(t),this._setConnectInfo(t),this.render(t.template||n.HTML.item),t.helper&&this._makeBridgeInfoElement(t.helper)},_setRoot:function(t){this._root=t.root,this._$root=t.root.$el},_setItemInfo:function(t){this.name=t.name,this._type=t.type||this._extractExtension(),this._id=t.id||t.name,this.size=t.size||"",this._btnClass=t.deleteButtonClassName||"uploader_btn_delete",this._unit=t.unit||"KB"},_setConnectInfo:function(t){this._url=t.url,this._hiddenInputName=t.hiddenFieldName||"filename"},render:function(t){var e=this._getHtml(t);this._$el=$(e),this._$root.append(this._$el),this._addEvent()},_extractExtension:function(){return this.name.split(".").pop()},_makeBridgeInfoElement:function(t){this.$helper=$("<input />"),this.$helper.attr({name:t.name,value:t.url})},_getHtml:function(t){var e={filetype:this._type,filename:this.name,filesize:this.size?s.getFileSizeWithUnit(this.size):"",deleteButtonClassName:this._btnClass};return s.template(e,t)},destroy:function(){this._removeEvent(),this._$el.remove()},_addEvent:function(){var t="."+this._btnClass,e=this._$el.find(t);e.on("click",ne.util.bind(this._onClickEvent,this))},_removeEvent:function(){var t="."+this._btnClass,e=this._$el.find(t);e.off("click")},_onClickEvent:function(){this.fire("remove",{filename:this.name,id:this._id,type:"remove"})}});ne.util.CustomEvents.mixin(a),e.exports=a},{"../statics":6,"../utils":8}],12:[function(t,e,i){var n=t("../utils"),s=t("./item"),a=ne.util.defineClass({init:function(t,e){var i=t.listInfo;this.items=[],this.$el=i.list,this.$counter=i.count,this.$size=i.size,this._uploader=e,ne.util.extend(this,t)},update:function(t){"remove"===t.action?this._removeFileItem(t.name):this._addFileItems(t.items)},updateTotalInfo:function(t){this._updateTotalCount(t.count),n.isSupportFormData()&&this._updateTotalUsage(t.size)},_updateTotalCount:function(t){ne.util.isExisty(t)||(t=this.items.length),this.$counter.html(t)},_updateTotalUsage:function(t){ne.util.isExisty(t)||(t=this._getSumAllItemUsage()),t=n.getFileSizeWithUnit(t),this.$size.html(t)},_getSumAllItemUsage:function(){var t=this.items,e=0;return ne.util.forEach(t,function(t){e+=parseFloat(t.size)}),e},_addFileItems:function(t){ne.util.isArray(t)||(t=[t]),ne.util.forEach(t,function(t){this.items.push(this._createItem(t))},this),this._uploader.fire("fileAdded",{target:t})},_removeFileItem:function(t){t=decodeURIComponent(t),this.items=ne.util.filter(this.items,function(e){var i=t===decodeURIComponent(e.name);return i&&(e.destroy(),this._uploader.remove(t),this._uploader.fire("fileRemoved",{name:t})),!i},this)},_createItem:function(t){var e=new s({root:this,name:t.name,size:t.size,deleteButtonClassName:this.deleteButtonClassName,url:this.url,hiddenFrame:this.formTarget,hiddenFieldName:this.hiddenFieldName,template:this.template&&this.template.item});return e.on("remove",this._removeFile,this),e},_removeFile:function(t){this.fire("remove",t)}});ne.util.CustomEvents.mixin(a),e.exports=a},{"../utils":8,"./item":11}],13:[function(t,e,i){var n=ne.util.defineClass({init:function(t){this.planet=t,this.files={},this.frag=document.createDocumentFragment()},store:function(t){this.files[t.file_name]=t,this.frag.appendChild(t)},remove:function(t){this.frag.removeChild(this.files[t]),delete this.files[t]},empty:function(){ne.util.forEach(this.files,function(t){this.remove(t.file_name)},this)},plant:function(){var t=this.planet;ne.util.forEach(this.files,function(e){t.appendChild(e),delete this.files[e.file_name]},this)}});e.exports=n},{}]},{},[1]);