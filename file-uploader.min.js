/*!component-file-uploader v1.0.0 | NHN Entertainment*/
!function(){var a={RESPONSE_TYPE:"RESPONSE_TYPE",REDIRECT_URL:"REDIRECT_URL",JSONPCALLBACK_NAME:"CALLBACK_NAME",SIZE_UNIT:"SIZE_UNIT",REMOVE_CALLBACK:"responseRemoveCallback",ERROR:{DEFAULT:"Unknown error.",NOT_SURPPORT:"This is x-domain connection, you have to make helper page."}},b={input:['<form enctype="multipart/form-data" id="formData" method="post">','<input type="hidden" name="MAX_FILE_SIZE" value="3000000" />','<input type="file" id="fileAttach" name="userfile[]" multiple="true" />',"</form>"].join(""),item:['<li class="filetypeDisplayClass">','<spna class="fileicon {{filetype}}">{{filetype}}</spna>','<span class="file_name">{{filename}}</span>','<span class="file_size">{{filesize}}</span>','<button type="button" class="{{deleteButtonClassName}}">Delete</button>',"</li>"].join("")};ne.util.defineNamespace("ne.component.Uploader"),ne.component.Uploader=ne.util.defineClass({init:function(a,b){var c=ne.component.Uploader.View;this._setData(a),this._setConnector(),this.$el=b,this.inputView=new c.Input(a,this),this.listView=new c.List(a,this),this._addEvent()},_setConnector:function(){var b=ne.component.Uploader;this.isCrossDomain()?this.helper?this.type="jsonp":alert(a.ERROR.NOT_SURPPORT):this.useJsonp||!this._isSupportDataForm()?this.type="jsonp":this.type="ajax",this._connector=new b.Connector(this)},notify:function(a){this.listView.update(a),this.listView.updateTotalInfo(a)},_setData:function(a){ne.util.extend(this,a)},isCrossDomain:function(){var a=document.domain;return-1===this.url.send.indexOf(a)},_isSupportDataForm:function(){var a=FormData||null;return!!a},sendFile:function(){var a=ne.util.bind(this.notify,this);this._connector.send({type:"add",success:a,error:this.errorCallback})},errorCallback:function(b){var c;c=b&&b.msg?b.msg:a.ERROR.DEFAULT,alert(c)},removeFile:function(a){var b=ne.util.bind(this.notify,this);this._connector.send({type:"remove",data:a,success:b})},_addEvent:function(){this.listView.on("remove",this.removeFile,this),this.inputView.on("change",this.sendFile,this)}}),ne.util.CustomEvents.mixin(ne.component.Uploader),ne.util.defineNamespace("ne.component.Uploader.Ajax"),ne.component.Uploader.Ajax={type:"POST",addRequest:function(a){var b=this._uploader.inputView.$el,c=ne.util.bind(this.successPadding,this,a.success);this.formData=new FormData(b[0]),$.ajax({url:this._uploader.url.send,type:this.type,data:this.formData,success:c,processData:!1,contentType:!1,error:a.error})},successPadding:function(a,b){var c=JSON.parse(b),d={};d.items=c.filelist,a(d)},removeRequest:function(a){var b=ne.util.bind(this.removePadding,this,a.success);$.ajax({url:this._uploader.url.remove,data:a.data,success:b,error:a.error})},removePadding:function(a,b){var c=JSON.parse(b),d={};d.action="remove",d.name=decodeURIComponent(c.name),a(d)}},ne.util.defineNamespace("ne.component.Uploader.Connector"),ne.component.Uploader.Connector=ne.util.defineClass({init:function(a){var b=this._getMixinModuleName(a.type);this._uploader=a,this.mixin(ne.component.Uploader[b])},_getMixinModuleName:function(a){return a.replace(a.charAt(0),a.charAt(0).toUpperCase())},send:function(a){"remove"===a.type?this.removeRequest(a):this.addRequest(a)},mixin:function(a){ne.util.extend(this,a)}}),ne.util.defineNamespace("ne.component.Uploader.Jsonp"),ne.component.Uploader.Jsonp={addRequest:function(a){var b=this._uploader.callbackName,c=a.success;ne.util.defineNamespace(b,ne.util.bind(this.successPadding,this,c)),this._uploader.inputView.$el.submit()},successPadding:function(a,b){var c={};this._uploader.isCrossDomain()?c.items=this._getSplitItems(b):c.items=b.filelist,a(c)},_getSplitItems:function(a){var b=this._uploader.separator,c=a.status.split(b),d=a.names.split(b),e=a.sizes.split(b),f=[];return ne.util.forEach(c,function(a,b){if("success"===a){var g={name:d[b],status:c[b],size:e[b]};f.push(g)}}),f},removeRequest:function(a){var b=this._uploader.callbackName,c={callback:b},d=a.success;ne.util.defineNamespace(b,ne.util.bind(this.removePadding,this,d),!0),$.ajax({url:this._uploader.url.remove,dataType:"jsonp",jsonp:b,data:ne.util.extend(c,a.data)})},removePadding:function(a,b){var c={};c.action="remove",c.name=decodeURIComponent(b.name),a(c)}},ne.util.defineNamespace("ne.component.Uploader.View.Input"),ne.component.Uploader.View.Input=ne.util.defineClass({init:function(a,c){var d=a.template&&a.template.input||b.input;this._uploader=c,this._target=a.formTarget,this._url=a.url,this._render(d),this._renderHiddenElements(),a.helper&&this._makeBridgeInfoElement(a.helper),this._addEvent()},_render:function(a){this.$el=$(a),this.$el.attr({action:this._url.send,method:"post",enctype:"multipart/form-data",target:this._target}),this._uploader.$el.append(this.$el)},_renderHiddenElements:function(){this._makeTargetFrame(),this._makeResultTypeElement(),this._makeCallbackElement(),this._makeSizeUnit()},_addEvent:function(){this.$el.on("change",ne.util.bind(this.onChange,this))},onChange:function(){this.fire("change",{target:this})},_makeTargetFrame:function(){this._$target=$('<iframe name="'+this._target+'"></iframe>'),this._$target.css({visibility:"hidden",position:"absolute"}),this._uploader.$el.append(this._$target)},_makeSizeUnit:function(){this._$sizeunit=this._makeHiddenElement({name:a.SIZE_UNIT,value:this._uploader.sizeunit}),this.$el.append(this._$sizeunit)},_makeCallbackElement:function(){this._$callback=this._makeHiddenElement({name:a.JSONPCALLBACK_NAME,value:this._uploader.callbackName}),this.$el.append(this._$callback)},_makeResultTypeElement:function(){this._$resType=this._makeHiddenElement({name:this._uploader.resultTypeElementName||a.RESPONSE_TYPE,value:this._uploader.type}),this.$el.append(this._$resType)},_makeBridgeInfoElement:function(b){this._$helper=this._makeHiddenElement({name:b.name||a.REDIRECT_URL,value:b.url}),this.$el.append(this._$helper)},_makeHiddenElement:function(a){return ne.util.extend(a,{type:"hidden"}),$("<input />").attr(a)}}),ne.util.CustomEvents.mixin(ne.component.Uploader.View.Input),ne.util.defineNamespace("ne.component.Uploader.View.Item"),ne.component.Uploader.View.Item=ne.util.defineClass({init:function(a){this._setRoot(a),this._setItemInfo(a),this._setConnectInfo(a),this.render(a.template||b.item),a.helper&&this._makeBridgeInfoElement(a.helper)},_setRoot:function(a){this._root=a.root,this._$root=a.root.$el},_setItemInfo:function(a){this.name=a.name,this._type=a.type||this._extractExtension(),this._id=a.id||a.name,this.size=a.size||"",this._btnClass=a.deleteButtonClassName||"uploader_btn_delete",this._unit=a.unit||"KB"},_setConnectInfo:function(a){this._url=a.url,this._hiddenInputName=a.hiddenFieldName||"filename"},render:function(a){var b=this._getHtml(a);this._$el=$(b),this._$root.append(this._$el),this._addEvent()},_extractExtension:function(){return this.name.split(".").pop()},_makeBridgeInfoElement:function(a){this.$helper=$("<input />"),this.$helper.attr({name:a.name,value:a.url})},_getHtml:function(a){var b={filetype:this._type,filename:this.name,filesize:this._getSizeWithUnit(this.size),deleteButtonClassName:this._btnClass};return a=a.replace(/\{\{([^\}]+)\}\}/g,function(a,c){return b[c]})},_getSizeWithUnit:function(a){return a+this._unit},destroy:function(){this._removeEvent(),this._$el.remove()},_addEvent:function(){var a="."+this._btnClass,b=this._$el.find(a);b.on("click",ne.util.bind(this._onClickEvent,this))},_removeEvent:function(){var a="."+this._btnClass,b=this._$el.find(a);b.off("click")},_onClickEvent:function(){this.fire("remove",{filename:this.name,id:this._id,type:"remove"})}}),ne.util.CustomEvents.mixin(ne.component.Uploader.View.Item),ne.util.defineNamespace("ne.component.Uploader.View.List"),ne.component.Uploader.View.List=ne.util.defineClass({init:function(a,b,c){var d=a.listInfo;this.items=[],this.$el=d.list,this.$counter=d.count,this.$size=d.size,this._uploader=b,ne.util.extend(this,a)},update:function(a){"remove"===a.action?this.items=ne.util.filter(this.items,function(b){return decodeURIComponent(a.name)===decodeURIComponent(b.name)?(b.destroy(),!1):!0}):this._addFiles(a.items)},updateTotalInfo:function(a){this._updateTotalCount(a.count),this._updateTotalUsage(a.size)},_updateTotalCount:function(a){ne.util.isExisty(a)||(a=this.items.length),this.$counter.html(a)},_updateTotalUsage:function(a){ne.util.isExisty(a)||(a=this._getSumAllItemUsage()),this.$size.html(a)},_getSumAllItemUsage:function(){var a=this.items,b=0;return ne.util.forEach(a,function(a){b+=parseInt(a.size,10)}),b+this.sizeunit},_addFiles:function(a){ne.util.isArray(a)||(a=[a]),ne.util.forEach(a,function(a){this.items.push(this._createItem(a))},this)},_createItem:function(a){var b=new ne.component.Uploader.View.Item({root:this,name:a.name,size:a.size,deleteButtonClassName:this.deleteButtonClassName,url:this.url,hiddenFrame:this.formTarget,hiddenFieldName:this.hiddenFieldName,template:this.template&&this.template.item,unit:this.sizeunit});return b.on("remove",this._removeFile,this),b},_removeFile:function(a){this.fire("remove",a)}}),ne.util.CustomEvents.mixin(ne.component.Uploader.View.List)}();
//# sourceMappingURL=file-uploader.min.map