!function e(t,i,n){function s(o,r){if(!i[o]){if(!t[o]){var l="function"==typeof require&&require;if(!r&&l)return l(o,!0);if(a)return a(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var h=i[o]={exports:{}};t[o][0].call(h.exports,function(e){var i=t[o][1][e];return s(i?i:e)},h,h.exports,e,t,i,n)}return i[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(e,t,i){ne.util.defineNamespace("ne.component.Uploader",e("./src/js/uploader.js"))},{"./src/js/uploader.js":7}],2:[function(e,t,i){var n={type:"POST",addRequest:function(e){var t=this._uploader.inputView.$el,i=ne.util.bind(this.successPadding,this,e.success);this.formData=new FormData(t[0]),$.ajax({url:this._uploader.url.send,type:this.type,data:this.formData,success:i,processData:!1,contentType:!1,error:e.error})},successPadding:function(e,t){var i=JSON.parse(t),n={};n.items=i.filelist,e(n)},removeRequest:function(e){var t=ne.util.bind(this.removePadding,this,e.success);$.ajax({url:this._uploader.url.remove,data:e.data,success:t,error:e.error})},removePadding:function(e,t){var i=JSON.parse(t),n={};n.action="remove",n.name=decodeURIComponent(i.name),e(n)}};t.exports=n},{}],3:[function(e,t,i){var n=e("./ajax.js"),s=e("./jsonp.js"),a=e("./local.js"),o={ajax:n,jsonp:s,local:a},r={getConnector:function(e){var t=e.type.toLowerCase(),i=ne.util.extend({_uplodaer:e,send:function(e){"remove"===e.type?this.removeRequest(e):this.addRequest(e)}},o[t]||a);return i}};t.exports=r},{"./ajax.js":2,"./jsonp.js":4,"./local.js":5}],4:[function(e,t,i){var n={addRequest:function(e){var t=this._uploader.callbackName,i=e.success;ne.util.defineNamespace(t,ne.util.bind(this.successPadding,this,i)),this._uploader.inputView.$el.submit()},successPadding:function(e,t){var i={};i.items=this._uploader.isCrossDomain()?this._getSplitItems(t):t.filelist,e(i)},_getSplitItems:function(e){var t=this._uploader.separator,i=e.status.split(t),n=e.names.split(t),s=e.sizes.split(t),a=ne.util.isString(e.ids)?e.ids.split(t):n,o=[];return ne.util.forEach(i,function(e,t){if("success"===e){var r={name:n[t],status:i[t],size:s[t],id:a[t]};o.push(r)}}),o},removeRequest:function(e){var t=this._uploader.callbackName,i={callback:t},n=e.success;ne.util.defineNamespace(t,ne.util.bind(this.removePadding,this,n),!0),$.ajax({url:this._uploader.url.remove,dataType:"jsonp",jsonp:t,data:ne.util.extend(i,e.data)})},removePadding:function(e,t){var i={};i.action="remove",i.name=decodeURIComponent(t.name),e(i)}};t.exports=n},{}],5:[function(e,t,i){var n=e("../statics.js"),s={addRequest:function(e){this._saveFile(n.isSupportFormData()),e.success({items:this._result,isReset:!0})},_saveFile:function(e){var t=this._uploader,i=t.inputView,n=i.$input[0],s=[];e?ne.util.forEach(n.files,function(e){s.push(e)},this):s.push({name:n.value,element:n}),this._result=s},_makeFormData:function(){var e=this._uploader,t=new window.FormData(e.inputView.$el[0]);return ne.util.forEach(this._result,function(i){t.append(e.fileField,i)}),t},removeRequest:function(e){console.log("remove",e)},submit:function(e){var t=this._makeFormData();$.ajax({url:this._uploader.url.send,type:"POST",data:t,success:e,processData:!1,contentType:!1})}};t.exports=s},{"../statics.js":6}],6:[function(e,t,i){t.exports.CONF={RESPONSE_TYPE:"RESPONSE_TYPE",REDIRECT_URL:"REDIRECT_URL",JSONPCALLBACK_NAME:"CALLBACK_NAME",SIZE_UNIT:"SIZE_UNIT",REMOVE_CALLBACK:"responseRemoveCallback",ERROR:{DEFAULT:"Unknown error.",NOT_SURPPORT:"This is x-domain connection, you have to make helper page."},FILE_FILED_NAME:"userfile[]"},t.exports.HTML={input:['<form enctype="multipart/form-data" id="formData" method="post">','<input type="hidden" name="MAX_FILE_SIZE" value="3000000" />','<input type="file" id="fileAttach" name="{{fileField}}" multiple="true" />','<button class="batchSubmit" type="submit">SEND</button>',"</form>"].join(""),item:['<li class="filetypeDisplayClass">','<spna class="fileicon {{filetype}}">{{filetype}}</spna>','<span class="file_name">{{filename}}</span>','<span class="file_size">{{filesize}}</span>','<button type="button" class="{{deleteButtonClassName}}">Delete</button>',"</li>"].join("")},t.exports.getFileSizeWithUnit=function(e){var t=["B","KB","MB","GB","TB"],e=parseInt(e,10),i=Math.log(e)/Math.log(1024)|0,n=(e/Math.pow(1024,i)).toFixed(2);return n+t[i]},t.exports.isSupportFormData=function(){var e=window.FormData||null;return!!e},t.exports.template=function(e,t){return t=t.replace(/\{\{([^\}]+)\}\}/g,function(t,i){return e[i]})}},{}],7:[function(e,t,i){var n=e("./statics.js"),s=e("./connector/connector.js"),a=e("./view/input.js"),o=e("./view/list.js"),r=ne.util.defineClass({init:function(e,t){this._setData(e),this._setConnector(),this.$el=t,this.inputView=new a(e,this),this.listView=new o(e,this),this.fileField=this.fileField||n.CONF.FILE_FILED_NAME,this._addEvent()},_setConnector:function(){this.isBatchTransfer?this.type="local":this.isCrossDomain()?this.helper?this.type="jsonp":alert(n.CONF.ERROR.NOT_SURPPORT):this.type=this.useJsonp||!n.isSupportFormData()?"jsonp":"ajax",this._connector=s.getConnector(this)},notify:function(e){this.listView.update(e),this.listView.updateTotalInfo(e)},_setData:function(e){ne.util.extend(this,e)},isCrossDomain:function(){var e=document.domain;return-1===this.url.send.indexOf(e)},errorCallback:function(e){var t;t=e&&e.msg?e.msg:n.CONF.ERROR.DEFAULT,alert(t)},sendFile:function(){var e=ne.util.bind(this.notify,this);this._connector.send({type:"add",success:e,error:this.errorCallback})},removeFile:function(e){var t=ne.util.bind(this.notify,this);this._connector.send({type:"remove",data:e,success:t})},submit:function(){this._connector.submit(function(){console.log("uploader caomplete")})},removeElement:function(e){},_getFileInfo:function(e){var t;return t=this._isSupportFileSystem()?this._getFileList(e.files):{name:e.value,id:e.value}},_getFileList:function(e){return ne.util.map(e,function(e){return console.log(e),{name:e.name,size:e.size,id:e.name}})},_isSupportFileSystem:function(){return!!(window.File&&window.FileReader&&window.FileList&&window.Blob)},_addEvent:function(){this.isBatchTransfer?(this.inputView.on("save",this.sendFile,this),this.listView.on("remove",this.removeFile,this)):(this.inputView.on("change",this.sendFile,this),this.listView.on("remove",this.removeFile,this))}});ne.util.CustomEvents.mixin(r),t.exports=r},{"./connector/connector.js":3,"./statics.js":6,"./view/input.js":8,"./view/list.js":10}],8:[function(e,t,i){var n=e("../statics.js"),s=ne.util.defineClass({init:function(e,t){this._uploader=t,this._target=e.formTarget,this._url=e.url,this._isBatchTransfer=e.isBatchTransfer,this.html=e.template&&e.template.input||n.HTML.input,this._render(),this._renderHiddenElements(),e.helper&&this._makeBridgeInfoElement(e.helper),this.$input=this.$el.find("input:file"),this._addEvent()},_render:function(){this.$el=$(this._getHtml(this.html)),this.$el.attr({action:this._url.send,method:"post",enctype:"multipart/form-data",target:this._target}),this._uploader.$el.append(this.$el)},_getHtml:function(e){var t={fileField:this._uploader.fileField};return n.template(t,e)},_renderHiddenElements:function(){this._makeTargetFrame(),this._makeResultTypeElement(),this._makeCallbackElement()},_addEvent:function(){var e=(this.$el.find("button:submit"),this);this._isBatchTransfer?(this.$input.on("change",ne.util.bind(this.onSave,this)),this.$el.on("submit",function(){return e._uploader.submit(),!1})):this.$input.on("change",ne.util.bind(this.onChange,this))},onChange:function(){this.fire("change",{target:this})},onSave:function(){this.fire("save",{element:this.$input[0],callback:ne.util.bind(this._changeElement,this)})},_changeElement:function(e){this._clone(e),this._addEvent()},_makeTargetFrame:function(){this._$target=$('<iframe name="'+this._target+'"></iframe>'),this._$target.css({visibility:"hidden",position:"absolute"}),this._uploader.$el.append(this._$target)},_makeCallbackElement:function(){this._$callback=this._makeHiddenElement({name:n.CONF.JSONPCALLBACK_NAME,value:this._uploader.callbackName}),this.$el.append(this._$callback)},_makeResultTypeElement:function(){this._$resType=this._makeHiddenElement({name:this._uploader.resultTypeElementName||n.CONF.RESPONSE_TYPE,value:this._uploader.type}),this.$el.append(this._$resType)},_makeBridgeInfoElement:function(e){this._$helper=this._makeHiddenElement({name:e.name||n.CONF.REDIRECT_URL,value:e.url}),this.$el.append(this._$helper)},_makeHiddenElement:function(e){return ne.util.extend(e,{type:"hidden"}),$("<input />").attr(e)},_clone:function(e){this.$input.off()}});ne.util.CustomEvents.mixin(s),t.exports=s},{"../statics.js":6}],9:[function(e,t,i){var n=e("../statics.js"),s=ne.util.defineClass({init:function(e){this._setRoot(e),this._setItemInfo(e),this._setConnectInfo(e),this.render(e.template||n.HTML.item),e.helper&&this._makeBridgeInfoElement(e.helper)},_setRoot:function(e){this._root=e.root,this._$root=e.root.$el},_setItemInfo:function(e){this.name=e.name,this._type=e.type||this._extractExtension(),this._id=e.id||e.name,this.size=e.size||"",this._btnClass=e.deleteButtonClassName||"uploader_btn_delete",this._unit=e.unit||"KB"},_setConnectInfo:function(e){this._url=e.url,this._hiddenInputName=e.hiddenFieldName||"filename"},render:function(e){var t=this._getHtml(e);this._$el=$(t),this._$root.append(this._$el),this._addEvent()},_extractExtension:function(){return this.name.split(".").pop()},_makeBridgeInfoElement:function(e){this.$helper=$("<input />"),this.$helper.attr({name:e.name,value:e.url})},_getHtml:function(e){var t={filetype:this._type,filename:this.name,filesize:n.getFileSizeWithUnit(this.size),deleteButtonClassName:this._btnClass};return n.template(t,e)},destroy:function(){this._removeEvent(),this._$el.remove()},_addEvent:function(){var e="."+this._btnClass,t=this._$el.find(e);t.on("click",ne.util.bind(this._onClickEvent,this))},_removeEvent:function(){var e="."+this._btnClass,t=this._$el.find(e);t.off("click")},_onClickEvent:function(){this.fire("remove",{filename:this.name,id:this._id,type:"remove"})}});ne.util.CustomEvents.mixin(s),t.exports=s},{"../statics.js":6}],10:[function(e,t,i){var n=e("../statics.js"),s=e("./item.js"),a=ne.util.defineClass({init:function(e,t){var i=e.listInfo;this.items=[],this.$el=i.list,this.$counter=i.count,this.$size=i.size,this._uploader=t,ne.util.extend(this,e)},update:function(e){"remove"===e.action?this.items=ne.util.filter(this.items,function(t){return decodeURIComponent(e.name)===decodeURIComponent(t.name)?(t.destroy(),!1):!0}):this._addFiles(e.items)},updateTotalInfo:function(e){this._updateTotalCount(e.count),this._updateTotalUsage(e.size)},_updateTotalCount:function(e){ne.util.isExisty(e)||(e=this.items.length),this.$counter.html(e)},_updateTotalUsage:function(e){ne.util.isExisty(e)||(e=this._getSumAllItemUsage()),e=n.getFileSizeWithUnit(e),this.$size.html(e)},_getSumAllItemUsage:function(){var e=this.items,t=0;return ne.util.forEach(e,function(e){t+=parseFloat(e.size)}),t},_addFiles:function(e){ne.util.isArray(e)||(e=[e]),ne.util.forEach(e,function(e){this.items.push(this._createItem(e))},this)},_createItem:function(e){var t=new s({root:this,name:e.name,size:e.size,deleteButtonClassName:this.deleteButtonClassName,url:this.url,hiddenFrame:this.formTarget,hiddenFieldName:this.hiddenFieldName,template:this.template&&this.template.item});return t.on("remove",this._removeFile,this),t},_removeFile:function(e){this.fire("remove",e)}});ne.util.CustomEvents.mixin(a),t.exports=a},{"../statics.js":6,"./item.js":9}]},{},[1]);