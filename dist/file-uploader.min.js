/**
 * tui-component-file-uploader
 * @author NHNEnt FE Development lab <dl_javascript@nhnent.com>
 * @version v1.1.1
 * @license MIT
 */
!function t(e,i,s){function n(r,a){if(!i[r]){if(!e[r]){var h="function"==typeof require&&require;if(!a&&h)return h(r,!0);if(o)return o(r,!0);var l=new Error("Cannot find module '"+r+"'");throw l.code="MODULE_NOT_FOUND",l}var u=i[r]={exports:{}};e[r][0].call(u.exports,function(t){var i=e[r][1][t];return n(i?i:t)},u,u.exports,t,e,i,s)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<s.length;r++)n(s[r]);return n}({1:[function(t,e,i){"use strict";tui.util.defineNamespace("tui.component",{FileUploader:t("./src/js/uploader.js")})},{"./src/js/uploader.js":6}],2:[function(t,e,i){"use strict";e.exports.CONF={REQUESTER_TYPE_MODERN:"modernRequester",REQUESTER_TYPE_OLD:"oldRequester",FORM_TARGET_NAME:"tuiUploaderHiddenFrame"},e.exports.CLASSNAME={HIDDEN_FILE_INPUT:"tui-js-hidden-file-input",LIST_CONTAINER:"tui-js-file-uploader-list",LIST_ITEMS_CONTAINER:"tui-js-file-uploader-list-items",DROPZONE:"tui-js-file-uploader-dropzone",USE_DROPZONE:"tui-dropzone-using",DROP_ENABLED:"tui-dropzone-enabled",HAS_ITEMS:"tui-has-items",IS_CHECKED:"tui-is-checked",THEAD_STYLE:"tui-col-name"},e.exports.HTML={FORM:'<form enctype="multipart/form-data" id="tui-uploader-form" method="post"></form>',HIDDEN_INPUT:'<input type="hidden" name="{{name}}" value="{{value}}">',CHECKBOX:['<label class="tui-checkbox">','<span class="tui-ico-check"><input type="checkbox"></span>',"</label>"].join(""),REMOVE_BUTTON:'<button type="button" class="tui-btn-delete">Remove</button>'},e.exports.LIST_TEMPLATE={CONTAINER:'<ul class="tui-upload-lst {{listItemsClassName}}"></ul>',LIST_ITEM:['<li class="tui-upload-item">','<span class="tui-filename-area">','<span class="tui-file-name">{{filename}} ({{filesize}})</span>',"</span>",'<button type="button" class="tui-btn-delete">remove</button>',"</li>"].join("")},e.exports.TABLE_TEMPLATE={CONTAINER:['<table class="tui-file-uploader-tbl">',"<caption><span>File Uploader List</span></caption>","<colgroup>",'<col width="32">','<col width="156">','<col width="362">','<col width="">',"</colgroup>",'<thead class="tui-form-header">',"<tr>",'<th scope="col">','<label class="tui-checkbox">','<span class="tui-ico-check"><input type="checkbox"></span>',"</label>","</th>",'<th scope="col">File Type</th>','<th scope="col">File Name</th>','<th scope="col">File Size</th>',"</tr>","</thead>",'<tbody class="tui-form-body {{listItemsClassName}}"></tbody>',"</table>"].join(""),LIST_ITEM:["<tr>","<td>",'<label class="tui-checkbox">','<span class="tui-ico-check"><input type="checkbox"></span>',"</label>","</td>","<td>{{filetype}}</td>","<td>{{filename}}</td>","<td>{{filesize}}</td>","</tr>"].join("")}},{}],3:[function(t,e,i){"use strict";var s=t("./consts"),n=tui.util,o=n.forEach,r=n.hasStamp,a=n.stamp,h=s.CLASSNAME.HIDDEN_FILE_INPUT,l=tui.util.defineClass({init:function(t){this.planet=t,this.files={}},store:function(t){var e,i,s=r(t)&&a(t);s&&(e=t.value,i=s+e,this.files[i]=t)},remove:function(t){var e=t.id+t.name,i=this.files[e];return!!i&&(delete this.files[e],!0)},empty:function(){this.files={}},plant:function(){var t=this.planet;o(this.files,function(e,i){e.className=h,e.style.display="none",t.appendChild(e),delete this.files[i]},this)}});e.exports=l},{"./consts":2}],4:[function(t,e,i){"use strict";var s=t("../consts"),n=s.CONF.REQUESTER_TYPE_MODERN,o=tui.util.forEach,r=tui.util.defineClass({init:function(t){this.uploader=t,this.formView=t.formView,this.pool=[],t.isBatchTransfer&&(this.remove=this._removeWhenBatch)},TYPE:n,_uploadError:function(t,e,i){this.fire("error",{status:e,message:i})},_uploadSuccess:function(t){this.fire("uploaded",JSON.parse(t))},store:function(t){var e=this.pool,i=tui.util.stamp,s=[];t=tui.util.toArray(t||this.formView.$fileInput[0].files),o(t,function(t){var n=i(t);e.push(t),s.push({id:n,name:t.name,size:t.size})}),this.formView.resetFileInput(),this.fire("stored",s)},upload:function(){var t,e=this.formView.$fileInput.attr("name"),i=this.formView.$el.clone();i.find('input[type="file"]').remove(),t=new FormData(i[0]),o(this.pool,function(i){t.append(e,i)}),$.ajax({url:this.uploader.url.send,type:"POST",data:t,success:$.proxy(this._uploadSuccess,this),error:$.proxy(this._uploadError,this),processData:!1,contentType:!1}),this.clear()},remove:function(t){$.ajax({url:this.uploader.url.remove,dataType:"jsonp",data:t,success:$.proxy(function(t){this.fire("removed",t)},this)})},_removeWhenBatch:function(t){var e=!1;o(t.filelist,function(t){e=this._removeFileInPool(t),t.state=e},this),this.fire("removed",tui.util.extend({message:e?"success":"fail"},t))},_removeFileInPool:function(t){var e=this.pool,i=tui.util.hasStamp,s=tui.util.stamp,n=!1;return o(e,function(o,r){if(i(o)&&s(o)===t.id)return e.splice(r,1),n=!0,!1}),n},clear:function(){this.pool.length=0}});tui.util.CustomEvents.mixin(r),e.exports=r},{"../consts":2}],5:[function(t,e,i){"use strict";var s=t("../pool"),n=t("../consts"),o=n.CONF.REQUESTER_TYPE_OLD,r=tui.util.defineClass({init:function(t){var e=t.$targetFrame,i=t.formView;this.uploader=t,this.formView=i,this.pool=new s(i.$el[0]),t.isBatchTransfer&&(this.upload=this._uploadWhenBatch,this.remove=this._removeWhenBatch),e.on("load",$.proxy(this._onLoadHiddenFrame,this,e))},TYPE:o,_onLoadHiddenFrame:function(t){var e,i;try{e=t[0].contentWindow.document.body,i=tui.util.pick(e,"firstChild","data"),i&&(this.fire("uploaded",$.parseJSON(i)),e.innerHTML="")}catch(s){this.fire("error",{status:s.name,message:s.message})}},store:function(){var t=this.formView.$fileInput[0],e=tui.util.stamp(t);this.pool.store(t),this.formView.resetFileInput(),this.fire("stored",[{id:e,name:t.value,size:""}])},upload:function(){this.pool.plant(),this.formView.$el.submit(),this.formView.clear(),this.clear()},_uploadWhenBatch:function(){this.pool.plant()},remove:function(t){var e=this.uploader;$.ajax({url:e.url.remove,dataType:"jsonp",data:t,success:$.proxy(function(t){this.fire("removed",t)},this)})},_removeWhenBatch:function(t){var e=!1;tui.util.forEach(t.filelist,function(t){e=this.pool.remove(t),t.state=e},this),this.fire("removed",tui.util.extend({message:e?"success":"fail"},t))},clear:function(){this.pool.empty()}});tui.util.CustomEvents.mixin(r),e.exports=r},{"../consts":2,"../pool":3}],6:[function(t,e,i){"use strict";var s=t("./consts"),n=t("./utils"),o=t("./view/form"),r=t("./view/list"),a=t("./view/drag"),h=t("./requester/old"),l=t("./requester/modern"),u=s.CONF.REQUESTER_TYPE_MODERN,c=s.CLASSNAME,d=tui.util.defineClass({init:function(t,e){this.$el=t,this.url=e.url,this.redirectURL=e.redirectURL,this.formTarget=s.CONF.FORM_TARGET_NAME,this.$targetFrame=this._createTargetFrame().appendTo(this.$el),this.isBatchTransfer=!!e.isBatchTransfer,this.isCrossDomain=n.isCrossDomain(this.url.send),this.isSupportPostMessage=!!tui.util.pick(this.$targetFrame,"0","contentWindow","postMessage"),this.isMultiple=!!e.isMultiple,this.useDrag=!!e.useDrag,this.useFolder=!!e.useFolder,this.formView=new o(this),this.listView=new r(this.$el.find("."+c.LIST_CONTAINER),e.listUI),this.useDrag&&!this.useFolder&&n.isSupportFileSystem()&&(this.dragView=new a(this.$el.find("."+c.DROPZONE))),this._setRequester(),this._addEvent(),this.isCrossDomain&&this.isSupportPostMessage&&this._setPostMessageEvent()},_setRequester:function(){n.isSupportFormData()?this._requester=new l(this):this._requester=new h(this)},_setPostMessageEvent:function(){this.$targetFrame.off("load"),$(window).on("message",$.proxy(function(t){var e,i=t.originalEvent;this.url.send.indexOf(i.origin)!==-1&&(e=$.parseJSON(i.data),this.isBatchTransfer?this.clear():this.updateList(e.filelist),this.fire("success",e))},this))},_createTargetFrame:function(){var t=$('<iframe name="'+this.formTarget+'"></iframe>');return t.css({visibility:"hidden",position:"absolute"}),t},_addEvent:function(){this.listView.on("remove",this.removeFile,this),this.listView.on("check",function(t){this.fire("check",t)},this),this.isBatchTransfer?this._addEventWhenBatchTransfer():this._addEventWhenNormalTransfer()},_addEventWhenBatchTransfer:function(){this.formView.on({change:this.store,submit:this.submit},this),this._requester.on({removed:function(t){this.updateList(t.filelist,"remove"),this.fire("remove",t)},error:function(t){this.fire("error",t)},uploaded:function(t){this.clear(),this.fire("success",t)},stored:function(t){this.updateList(t),this.fire("update",t)}},this),this.useDrag&&this.dragView&&this.dragView.on("drop",this.store,this)},_addEventWhenNormalTransfer:function(){this.formView.on("change",this.sendFile,this),this._requester.on({removed:function(t){this.updateList(t.filelist,"remove"),this.fire("remove",t)},error:function(t){this.fire("error",t)},uploaded:function(t){this.updateList(t.filelist),this.fire("success",t)}},this),this.useDrag&&this.dragView&&this.dragView.on("drop",function(t){this.store(t),this.submit()},this)},updateList:function(t,e){this.listView.update(t,e)},sendFile:function(t){this.store(),this.submit(t)},removeFile:function(t){this._requester.remove(t)},submit:function(t){t&&this._requester.TYPE===u&&t.preventDefault(),this._requester.upload()},store:function(t){this._requester.store(t)},clear:function(){this._requester.clear(),this.formView.clear(),this.listView.clear()},removeCheckedList:function(){var t,e=this.listView,i=e.checkedIndexList,s=e.items,n=[];tui.util.forEach(i,function(e){t=s[e],n.push({id:t.id,name:t.name})},this),n.length&&this.removeFile({filelist:n})},getUploadedTotalCount:function(){return this.listView.items.length},getUploadedTotalSize:function(){var t=this.listView.items,e=0;return tui.util.forEach(t,function(t){e+=parseFloat(t.size)}),n.getFileSizeWithUnit(e)},getCheckedTotalCount:function(){return this.listView.checkedIndexList.length},getCheckedTotalSize:function(){var t,e=this.listView,i=e.checkedIndexList,s=0;return tui.util.forEach(i,function(i){t=e.items[i],s+=parseFloat(t.size)}),n.getFileSizeWithUnit(s)}});tui.util.CustomEvents.mixin(d),e.exports=d},{"./consts":2,"./requester/modern":4,"./requester/old":5,"./utils":7,"./view/drag":8,"./view/form":9,"./view/list":11}],7:[function(t,e,i){"use strict";function s(t){var e=document.createElement("a");return e.href=t,{href:e.href,host:e.host,port:e.port,hash:e.hash,hostname:e.hostname,pathname:e.pathname,protocol:e.protocol,search:e.search,query:e.search.slice(1)}}function n(t){var e,i,s=["B","KB","MB","GB","TB"];return t=parseInt(t,10),e=Math.log(t)/Math.log(1024)|0,i=(t/Math.pow(1024,e)).toFixed(2),i+" "+s[e]}function o(){return d}function r(t,e){return e=e.replace(/\{\{([^\}]+)\}\}/g,function(e,i){return t[i]})}function a(){return c}function h(t){var e=s(window.location.href),i=s(t);return i.hostname!==e.hostname||i.port!==e.port||i.protocol!==e.protocol}function l(t,e){for(var i=e.length-1;i>-1;)t===e[i]&&e.splice(i,1),i-=1}function u(t){var e=t.parents("label"),i=e.length;return i?e.eq(0):null}var c=!!(window.File&&window.FileReader&&window.FileList&&window.Blob),d=!!window.FormData;e.exports={getFileSizeWithUnit:n,isSupportFileSystem:a,isSupportFormData:o,template:r,isCrossDomain:h,removeItemFromArray:l,getLabelElement:u}},{}],8:[function(t,e,i){"use strict";var s=t("../consts"),n=s.CLASSNAME.USE_DROPZONE,o=s.CLASSNAME.DROP_ENABLED,r=tui.util.defineClass({init:function(t){this.$el=t.addClass(n),this._enableClass=o,this._addEvent()},_addEvent:function(){this.$el.on({dragenter:$.proxy(this.onDragEnter,this),dragover:$.proxy(this.onDragOver,this),drop:$.proxy(this.onDrop,this),dragleave:$.proxy(this.onDragLeave,this)})},onDragEnter:function(t){t.preventDefault(),t.stopPropagation(),this._enable()},onDragOver:function(t){t.preventDefault(),t.stopPropagation()},onDragLeave:function(t){t.preventDefault(),t.stopPropagation(),this._disable()},onDrop:function(t){var e=tui.util.pick(t,"originalEvent","dataTransfer","files");return t.preventDefault(),this._disable(),this.fire("drop",e),!1},_enable:function(){this.$el.addClass(this._enableClass)},_disable:function(){this.$el.removeClass(this._enableClass)}});tui.util.CustomEvents.mixin(r),e.exports=r},{"../consts":2}],9:[function(t,e,i){"use strict";var s=t("../consts"),n=t("../utils"),o=n.isSupportFormData(),r=s.CLASSNAME.HIDDEN_FILE_INPUT,a="__fe_id",h=tui.util.defineClass({init:function(t){this._uploader=t,this._html=this._setTemplate(t.template),this.$el=null,this.$fileInput=null,this.$submit=null,o&&(this._isMultiple=t.isMultiple,this._useFolder=t.useFolder),this._render({action:t.url.send,method:"post",enctype:"multipart/form-data",target:o?"":t.formTarget})},_render:function(t){var e=this._uploader,i=this._getFileInput(),s=$(this._html.FORM).append(e.$el.children()).attr(t);this.$el=s,this.$fileInput=i,e.isBatchTransfer&&(this.$submit=e.$el.find(":submit")),e.isCrossDomain&&!o&&this._setHiddenInputForCORS(),e.$el.append(this.$el),this._addEvent()},_setHiddenInputForCORS:function(){var t,e,i=this._uploader,s=i.redirectURL;i.isSupportPostMessage?t={name:"messageTarget",value:location.protocol+"//"+location.host}:s&&(t={name:"redirectURL",value:s}),t&&(e=$(n.template(t,this._html.HIDDEN_INPUT)),e.appendTo(this.$el))},_setTemplate:function(t){return tui.util.extend({},s.HTML,t)},_getFileInput:function(){var t=this._uploader.$el.find(":file"),e=this._isMultiple,i=this._useFolder;return t.prop({multiple:e,directory:i,mozdirectory:i,webkitdirectory:i}),t},_addEvent:function(){this._uploader.isBatchTransfer&&this.$el.on("submit",$.proxy(this.fire,this,"submit")),this._addInputEvent()},_addInputEvent:function(){this.$fileInput.on("change",$.proxy(this.onChange,this))},onChange:function(){this.$fileInput[0].value&&this.fire("change")},resetFileInput:function(){var t=this.$fileInput.clone();this.$fileInput.after(t),this.$fileInput.remove(),this.$fileInput=t,tui.util.hasStamp(this.$fileInput[0])&&delete this.$fileInput[0][a],this._addInputEvent()},clear:function(){this.$el.find("."+r).remove(),this.resetFileInput()}});tui.util.CustomEvents.mixin(h),e.exports=h},{"../consts":2,"../utils":7}],10:[function(t,e,i){"use strict";var s=t("../consts"),n=t("../utils"),o=s.CLASSNAME,r=s.HTML,a=tui.util.defineClass({init:function(t,e,i){this.$el=null,this.$checkbox=null,this.$removeButton=null,this.name=e.name,this.id=e.id||e.name,this.size=e.size||"",this.type=this._extractExtension(),this.template=i,this._render(t)},_render:function(t){var e=this._getHTML();this.$el=$(e).appendTo(t),this.$checkbox=this.$el.find(":checkbox"),this.$removeButton=this.$el.find("button"),this._addEvent()},_getHTML:function(){var t=this.template,e={filetype:this.type,filename:this.name,filesize:this.size?n.getFileSizeWithUnit(this.size):"",checkbox:r.CHECKBOX,removeButton:r.REMOVE_BUTTON};return n.template(e,t)},_extractExtension:function(){return this.name.split(".").pop()},_addEvent:function(){this.$checkbox.on("change",$.proxy(this.onChange,this)),this.$removeButton.on("click",$.proxy(this._onClickEvent,this))},_onClickEvent:function(){this.fire("remove",{name:this.name,id:this.id})},_changeCheckbox:function(t){var e=this.$checkbox,i=n.getLabelElement(e),s=i?i:e,r=o.IS_CHECKED;t?s.addClass(r):s.removeClass(r)},onChange:function(){var t=!!this.$checkbox.attr("checked");this._changeCheckbox(t),this.fire("check",{id:this.id,name:this.name,size:this.size},t)},destroy:function(){this.$el.remove()}});tui.util.CustomEvents.mixin(a),e.exports=a},{"../consts":2,"../utils":7}],11:[function(t,e,i){"use strict";var s=t("../utils"),n=t("./item"),o=t("../consts"),r=o.CLASSNAME,a=tui.util,h=a.forEach,l=a.isUndefined,u=a.isArraySafe,c=tui.util.defineClass({init:function(t,e){this.$el=t,this.$list=null,this.$checkbox=null,this.listType=e.type,this.item=e.item,this.columnList=e.columnList,this.itemTemplate=null,this.items=[],this.checkedIndexList=[],this._render(),this._addEvent()},_render:function(){var t="table"===this.listType,e=this._getListContainer(t);this.$el.append(e),t?(this._setColumnGroup(),this._setTableHeader(),this._setTableRowTemplate()):this._setListItemTemplate(),this.$list=this.$el.find("."+r.LIST_ITEMS_CONTAINER),this.$checkbox=this.$el.find(":checkbox")},_addEvent:function(){this.$checkbox&&this.$checkbox.on("change",$.proxy(this._onChange,this))},_onChange:function(){var t=!!this.$checkbox.attr("checked");this._changeCheckboxInItem(t),this._changeCheckboxInHeader(t)},_getListContainer:function(t){var e=t?o.TABLE_TEMPLATE:o.LIST_TEMPLATE;return $(s.template({listItemsClassName:r.LIST_ITEMS_CONTAINER},e.CONTAINER))},_setColumnGroup:function(){var t,e=this.$el.find("colgroup"),i=this.columnList,s="";h(i,function(e){t=e.width,s+=t?'<col width="'+e.width+'">':"<col>"}),i&&e.html(s)},_setTableHeader:function(){var t,e=this.columnList,i="";h(e,function(e){t=e.header,l(t)||(i+='<th scope="col">'+t+"</th>")}),this._setHeaderElement(i)},_setHeaderElement:function(t){var e=this.$el.find("thead"),i=r.THEAD_STYLE;t&&(t=s.template({checkbox:o.HTML.CHECKBOX},t),e.html("<tr>"+t+"</tr>")),e.find("th").first().addClass(i),e.find("th").last().addClass(i)},_setTableRowTemplate:function(){var t=this.columnList,e="";h(t,function(t){e+="<td>"+t.body+"</td>"}),e=e?"<tr>"+e+"</tr>":o.TABLE_TEMPLATE.LIST_ITEM,this.itemTemplate=e},_setListItemTemplate:function(){var t,e=this.item;t=e?"<li>"+e+"</li>":o.LIST_TEMPLATE.LIST_ITEM,this.itemTemplate=t},_setHasItemsClassName:function(){var t=r.HAS_ITEMS,e=!!this.items.length;e?this.$el.addClass(t):this.$el.removeClass(t)},_addFileItems:function(t){u(t)||(t=[t]),h(t,function(t){this.items.push(this._createItem(t))},this)},_removeFileItems:function(t){var e;this.checkedIndexList.length=0,h(t,function(t){e=this._findIndexOfItem(t.id),t.state?(this.items[e].destroy(),this.items.splice(e,1)):this.checkedIndexList.push(e)},this)},_findIndexOfItem:function(t){var e;return h(this.items,function(i,s){if(i.id===t)return e=s,!1}),e},_createItem:function(t){var e=new n(this.$list,t,this.itemTemplate);return e.on("remove",this._onRemove,this),e.on("check",this._onCheck,this),e},_onRemove:function(t){this.fire("remove",{filelist:[t]})},_onCheck:function(t,e){this._setCheckedItemsIndex(t.id,e),this._setCheckedAll(),this.fire("check",{id:t.id,name:t.name,size:t.size,isChecked:e})},_setCheckedItemsIndex:function(t,e){var i=this.checkedIndexList,n=this._findIndexOfItem(t);e?i.push(n):s.removeItemFromArray(n,i)},_setCheckedAll:function(){var t=this.checkedIndexList.length===this.items.length&&!!this.checkedIndexList.length;this.$checkbox.prop("checked",t),this._changeCheckboxInHeader(t)},_changeCheckboxInHeader:function(t){var e=this.$checkbox,i=s.getLabelElement(e),n=i?i:e,o=r.IS_CHECKED;t?n.addClass(o):n.removeClass(o)},_changeCheckboxInItem:function(t){this.checkedIndexList=[],h(this.items,function(e){e.$checkbox.prop("checked",t),e.onChange()})},update:function(t,e){"remove"===e?this._removeFileItems(t):this._addFileItems(t),this._setHasItemsClassName(),this._setCheckedAll()},clear:function(){h(this.items,function(t){t.destroy()}),this.items.length=0,this.checkedIndexList.length=0,this._setHasItemsClassName(),this._setCheckedAll()}});tui.util.CustomEvents.mixin(c),e.exports=c},{"../consts":2,"../utils":7,"./item":10}]},{},[1]);